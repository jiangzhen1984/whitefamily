<!DOCTYPE HTML>
<html xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">
<ui:include src="../include/header.xhtml" />

<body>
<script src="../view/javascript/highcharts.js"></script>
<div id="container">
<ui:include src="../include/menu_top.xhtml" />
<ui:include src="../include/nav.xhtml" />

<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <ul class="breadcrumb">
        <li><a href=""></a></li>
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    <c:if  test="${userBean.user.role == 'ADMIN'}">
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-6">
        <div class="tile">
           <div class="tile-heading">店铺营收 <span class="pull-right">
            <i class="fa fa-caret-up"></i>
            <i class="fa fa-caret-down"></i>
            1%</span></div>
          <div class="tile-body"><i class="fa fa-shopping-cart"></i>
            <h2 class="pull-right" id="si">0￥</h2>
          </div>
          <div class="tile-footer"><a href="">查看详细信息</a></div>
       </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6">
      <div class="tile">
           <div class="tile-heading">库存统计 <span class="pull-right">
            <i class="fa fa-caret-up"></i>
            <i class="fa fa-caret-down"></i>
            1%</span></div>
          <div class="tile-body"><i class="fa fa-credit-card"></i>
            <h2 class="pull-right" id="ic" >0￥</h2>
          </div>
          <div class="tile-footer"><a href="">查看详细信息</a></div>
       </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6">
      <div class="tile">
           <div class="tile-heading">店铺支出 <span class="pull-right">
            <i class="fa fa-caret-up"></i>
            <i class="fa fa-caret-down"></i>
            1%</span></div>
          <div class="tile-body"><i class="fa fa-user"></i>
            <h2 class="pull-right" id="sc">0￥</h2>
          </div>
          <div class="tile-footer"><a href="">查看详细信息</a></div>
       </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6">
      <div class="tile">
           <div class="tile-heading">配送统计 <span class="pull-right">
            <i class="fa fa-caret-up"></i>
            <i class="fa fa-caret-down"></i>
            1%</span></div>
          <div class="tile-body"><i class="fa fa-shopping-cart"></i>
            <h2 class="pull-right">0￥</h2>
          </div>
          <div class="tile-footer"><a href="">查看详细信息</a></div>
       </div>
      </div>
    </div>
    <!-- 
    <div class="row">
      <div class="col-lg-6 col-md-12 col-sx-12 col-sm-12">
      <div class="panel panel-default">
              <div class="panel-heading"> 
                 <select  onchange="queryIncomingSelect(this, '#{s.id}');">
                     <OPTION value="1">1月</OPTION>
                     <OPTION value="2">2月</OPTION>
                     <OPTION value="3">3月</OPTION>
                     <OPTION value="4">4月</OPTION>
                     <OPTION value="5">5月</OPTION>
                     <OPTION value="6">6月</OPTION>
                     <OPTION value="7">7月</OPTION>
                     <OPTION value="8">8月</OPTION>
                     <OPTION value="9">9月</OPTION>
                     <OPTION value="10">10月</OPTION>
                     <OPTION value="11">11月</OPTION>
                     <OPTION value="12">12月</OPTION>                     
                   </select>
                 <div class="pull-right" id="datepicker">                  
                   <input type='hidden' class="input-group" />
                   <a href="#"  class="input-group" ><i class="fa fa-calendar"></i> <i class="caret"></i></a>
                </div>
                   <a href="#"  class="dropdown-toggle" data-toggle="dropdown" >店铺选择<i class="caret"></i></a>
                   <ul class="dropdown-menu">
                       <li><span onclick="queryIncoming('', pickerObject.date)">全部店铺</span></li>
                       <ui:repeat value="#{shopBean.shopList}" var="s">
                       <li><span onclick="queryIncoming('#{s.id}',pickerObject.date)" valign="middle">#{s.name}</span></li>
                      </ui:repeat>
                   </ul>
                </div>
                <div class="panel-body">
                  <div id="inventory-st" style="width: 100%; height: 260px;"></div>
                </div>
           </div>
      
      </div>
      <div class="col-lg-6 col-md-12 col-sx-12 col-sm-12">
          <div class="panel panel-default">
              <div class="panel-heading">
                  <select  onchange="queryCostSelect(this, '#{s.id}');">
                     <OPTION value="1">1月</OPTION>
                     <OPTION value="2">2月</OPTION>
                     <OPTION value="3">3月</OPTION>
                     <OPTION value="4">4月</OPTION>
                     <OPTION value="5">5月</OPTION>
                     <OPTION value="6">6月</OPTION>
                     <OPTION value="7">7月</OPTION>
                     <OPTION value="8">8月</OPTION>
                     <OPTION value="9">9月</OPTION>
                     <OPTION value="10">10月</OPTION>
                     <OPTION value="11">11月</OPTION>
                     <OPTION value="12">12月</OPTION>                     
                   </select>
                 <div class="pull-right" id="datepicker1">
                   <input type='hidden' class="input-group" />
                   <a href="#"  class="input-group" ><i class="fa fa-calendar"></i> <i class="caret"></i></a>
                </div>
                    <a href="#"  class="dropdown-toggle" data-toggle="dropdown" >店铺选择<i class="caret"></i></a>
                   <ul class="dropdown-menu">
                       <li><span onclick="queryCost('',pickerObject1.date)">全部店铺</span></li>
                       <ui:repeat value="#{shopBean.shopList}" var="s">
                       <li><span onclick="queryCost('#{s.id}',pickerObject1.date)" valign="middle">#{s.name}</span></li>
                      </ui:repeat>
                   </ul>
                </div>
                <div class="panel-body">
                  <div id="chart-sale" style="width: 100%; height: 260px;"></div>
                </div>
           </div>
      </div>
    </div>
     -->
    <div class="row">
      <div class="col-lg-4 col-md-12 col-sm-12 col-sx-12"></div>
      <div class="col-lg-8 col-md-12 col-sm-12 col-sx-12"> </div>
    </div>
    </c:if>
  </div>
</div>
<footer id="footer"><br /></footer></div>
<script type="text/javascript">
	function showIncoming(data, date) {
	    var incoming = $('#inventory-st').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: '营收统计'
	        },
	        subtitle: {
	            text: date
	        },
	        xAxis: {
	            categories: ['总流水', '现金', '支付宝', '微信', '闪惠', '糯米闪惠']
	        },
	        yAxis: {
	            title: {
	                text: '营收金额'
	            }
	        },
	        plotOptions: {
	            line: {
	                dataLabels: {
	                    enabled: true
	                },
	                enableMouseTracking: false
	            }
	        },
	        series: data
	    });
	}
</script>
		
		
<script type="text/javascript">
	function showCost(data, date) {
	    var cost = $('#chart-sale').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: '支出统计'
	        },
	        subtitle: {
	            text: date
	        },
	        xAxis: {
	            categories: ['日用调料', '烧饼', '补菜', '伙食费', '饮料', '水费', '电费', '燃气费', '房费', '工资', '日杂', '其他']
	        },
	        yAxis: {
	            title: {
	                text: '金额'
	            }
	        },
	        plotOptions: {
	            line: {
	                dataLabels: {
	                    enabled: true
	                },
	                enableMouseTracking: false
	            }
	        },
	        series: data
	    });
	};
</script>
<script type="text/javascript">
  var d;
  var pickerObject;
  $(function () {
      d = $('#datepicker').datetimepicker({ todayHighlight:'TRUE', format : "YYYY-MM-DD", autoclose : true, pickTime :false});
      pickerObject = d.data();
      pickerObject.pickTime = false;
      d.on("change", function(a, b) {
           queryIncoming('', pickerObject.date);
           d.datetimepicker('remove');
      });
      
  });
  
  
  var d1;
  var pickerObject1;
  $(function () {
      d1 = $('#datepicker1').datetimepicker({ todayHighlight:'TRUE', format : "YYYY-MM-DD", autoclose : true, pickTime :false});
      pickerObject1 = d1.data();
      pickerObject1.pickTime = false;
      d1.on("change", function(a, b) {
           queryCost('', pickerObject1.date);
           d1.datetimepicker('remove');
      });
      
  });
            
    function queryIncoming(shop, date) {
        if (date == undefined) {
            date ='';
        }
        $.ajax({
			url: 'chart.ajax?action=chart&amp;type=incoming&amp;shop='+shop+'&amp;date='+date,
			dataType: 'json',
			success: function(json) {
			    showIncoming(json, date);
			}
		});
    }
    
    
    function queryIncomingSelect(sl, shop) {
    	 $.ajax({
			url: 'chart.ajax?action=chart&amp;type=incoming&amp;shop='+shop+'&amp;date='+sl.value+'&amp;t=month',
			dataType: 'json',
			success: function(json) {
			    showIncoming(json, sl.value +'月');
			}
		});
    }
    
    function queryCost(shop, date) {
        if (date == undefined) {
            date ='';
        }
        $.ajax({
			url: 'chart.ajax?action=chart&amp;type=cost&amp;shop='+shop+'&amp;date='+date,
			dataType: 'json',
			success: function(json) {
			    showCost(json, date);
			}
		});
    }
    
      function queryCostSelect(sl, shop) {
    	 $.ajax({
			url: 'chart.ajax?action=chart&amp;type=cost&amp;shop='+shop+'&amp;date='+sl.value+'&amp;t=month',
			dataType: 'json',
			success: function(json) {
			    showCost(json, sl.value +'月');
			}
		});
    }
      
      
    function queryStatist() {
    	 $.ajax({
 			url: 'statist.ajax?action=statist&amp;',
 			dataType: 'json',
 			success: function(json) {
 			   $("#ic").html(json['ic']);
 			   $("#si").html(json['si']);
 			   $("#sc").html(json['sc']);
 			}
 		});
    }
    
    var cd = new Date();
   // queryIncoming('', (cd.getFullYear() +'-' + (cd.getMonth() + 1) + "-" + cd.getDate()));
   // queryCost('', (cd.getFullYear() +'-' + (cd.getMonth() + 1) + "-" + cd.getDate()));
    queryStatist();
</script>
</body></html>

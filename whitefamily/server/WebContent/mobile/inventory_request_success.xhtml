<!DOCTYPE html>
<html xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:h="http://java.sun.com/jsf/html">
<head>
<title>大白-订货提交</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<link href="style/css.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
</head>


<body>
<form action="http://localhost:8083/order/pay">
<div class="orderPayFor">
    <div class="shopCart_top">
    	<a href="clasify.xhtml"> <img src="images/back.png" class="icon_back" /></a>
        订单提交成功
        <img src="images/kefu.png" class="icon_kefu" />
	</div>    
    <div class="orderPayFor_content">
    	<div class="orderPayFor_address">
            <div class="orderPayFor_address_content">
                <div class="name"><h:outputText value="#{userBean.user.shop.name}" /><span><h:outputText value="#{userBean.user.username}" /></span></div>
                <div class="address">               		
                    <p><img src="images/address.png" class="icon_address" /><h:outputText value="#{userBean.user.shop.address}" /></p>
                     <img src="images/arrow_right.png" class="icon_21" />
                     <div class="clear"></div>
                </div>
            </div>
            <i class="icon_line"></i>
            <div class="clear"></div>
        </div>
        <div class="orderPayFor_order">
          <div class="orderPayFor_order_imgs">
           <!-- 
		  <div class="orderPayFor_order_imgs_1">
                	<img src="images/11.jpg" /><img src="images/14.jpg" /><img src="images/12.jpg" /><img src="images/11.jpg" /><img src="images/14.jpg" />
   		 </div>
   		  -->
         <div class="orderPayFor_order_sum">
         		<p class="grey small_2">共<h:outputText value="#{cartBean.cart.itemCount}" />类<img src="images/arrow_right.png" class="icon_21" /></p>
                
			</div>
      	</div>
      </div>
        <div class="orderPayFor_order">  
            <div class="orderPayFor_order_send">
            	预计配送时间
				  <div class="orderPayFor_send_right arrow_2">
           	    <p class="small_2 red">明天</p>
                </div>                
			</div>
      </div>


    <div class="orderPayFor_order total">  
            <div class="orderPayFor_order_send grey">
            	下单商品总额
				  <div class="orderPayFor_send_right arrow_2">
           	    <p>￥ <c:if test="#{userBean.user.franchiseeType == true}">
        	<span class="sum">总价:<span class="red big"><h:outputText value="#{cartBean.cart.totalPrice1}" /></span></span>
        	</c:if>
        	 <c:if test="#{userBean.user.franchiseeType == false}">
        	<span class="sum">总价:<span class="red big">￥<h:outputText value="#{cartBean.cart.totalPrice}" /></span></span>
        	</c:if></p>
                </div>
			</div> 
    </div>	
		<div class="submit_block">
            <div class="submit_block_left">
            		<span class="small_2">合计</span><span class="red">￥ <c:if test="#{userBean.user.franchiseeType == true}">
        	<span class="sum">总价:<span class="red big"><h:outputText value="#{cartBean.cart.totalPrice1}" /></span></span>
        	<input type="hidden" name="order_fee" value="#{cartBean.cart.totalPrice1}" />
        	</c:if>
        	 <c:if test="#{userBean.user.franchiseeType == false}">
        	<span class="sum">总价:<span class="red big">￥<h:outputText value="#{cartBean.cart.totalPrice}" /></span></span>
        	<input type="hidden" name="order_fee" value="#{cartBean.cart.totalPrice}" />
        	</c:if></span>
            </div>
          
         <c:if test="#{userBean.user.franchiseeType == true}">
			 <div class="submit_block_right">
			 		<input type="hidden" name="order_no" value="#{shopBean.inventoryRequest.id}" />
			 		<input type="hidden" name="order_desc" value="订单" />
			 		<input type="hidden" name="back_data" value="" />
			 		<input type="hidden" name="back_url" value="" />
                    <input type="submit"   type="submit" value="去支付" />
           	</div>
         </c:if>
        
        </div>
        
        
       
        <div class="clear"></div>
    </div>

</div>
</form>



<script type="text/javascript">
 //<![CDATA[
<!--
var jsok = false;

function createorder(orderno) {
	if (jsok == false) {
		console.log("===js is not ok");
		return;
	}
	console.log('===>' + orderno);
	 var rq= 'wxoc.ajaxj?orderno='+orderno;
	 $.ajax({
		url: rq,
		type: "post",
	  	success :function(data) {
	  		if (data.ret != 0) {
	  			alert("创建微信订单失败");
	  			return;
	  		}
	  	
	  		wx.chooseWXPay({
	  		    timeStamp: data.jsts, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
	  		    nonceStr: data.jsn, // 支付签名随机串，不长于 32 位
	  		    package: data.wxid, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）
	  		    signType: data.jsst, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'
	  		    paySign: data.jss, // 支付签名
	  		    success: function (res) {
	  		        alert(res);
	  		    },
	  		  fail: function(res) {	  		    	
	  		    	alert(JSON.stringify(res));
	  		    	alert("error11");
	  		    }
	  		});	
	  	}
  	});
}

function jsauth() {
	var rq= 'jsauth.ajaxj';
	 $.ajax({
		url: rq,
		async: true,
	  	success :function(data) {
	  		if (data.ret == 0) {
	  			wxjsConfig(data.appid, data.timestamp, data.nonce, data.sign)
	  		} else {
	  			console.log("js auth failed");
	  		}
	  	}
	  });
}


function wxjsConfig(appId, timestamp, nonceStr, signature) {
	wx.config({
		debug: true, 
	    appId: appId,
	    timestamp: timestamp, 
	    nonceStr: nonceStr,
	    signature: signature,
	    jsApiList: ['chooseWXPay'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
	})
} 

wx.ready(function(){	
	jsok = true;
	
});

wx.error(function(res){
	alert("error" + res);
});


jsauth();
//-->



//]]>
</script>

</body>
</html>
